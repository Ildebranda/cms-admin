<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CMS Ildebranda</title>
  <script src="https://unpkg.com/decap-cms@^3.10.0/dist/decap-cms.js"></script>
</head>
<body>
  <div id="nc-root"></div>

  <script>
    // 1. Definimos a configuração global ANTES do init
    window.CMS_CONFIG = {
      backend: {
        name: "github",
        repo: "Ildebranda/site-ildebranda",
        branch: "master",
        base_url: "https://decap-cms-oauth-gh.vercel.app",
        auth_endpoint: "auth"
      },
      load_config_file: false, // OBRIGATÓRIO: impede a busca pelo config.yml
      display_url: "https://cms-admin-navy.vercel.app",
      media_folder: "public/uploads",
      public_folder: "/uploads",
      collections: [
        {
          name: "obras",
          label: "Obras",
          folder: "content/obras",
          create: true,
          slug: "{{slug}}",
          format: "frontmatter",
          fields: [
            { label: "ID", name: "id", widget: "string" },
            { label: "Título", name: "titulo", widget: "string" },
            { label: "Categoria", name: "categoria", widget: "select", options: ["Traditional","Digital"] },
            { label: "Imagem", name: "img", widget: "image" },
            { label: "Descrição", name: "descricao", widget: "markdown" }
          ]
        },
        {
          name: "noticias",
          label: "Notícias",
          folder: "content/blog",
          create: true,
          slug: "{{slug}}",
          fields: [
            { label: "Título", name: "title", widget: "string" },
            { label: "Data", name: "date", widget: "datetime" },
            { label: "Conteúdo", name: "body", widget: "markdown" }
          ]
        },
        {
          name: "exposicoes",
          label: "Exposições",
          folder: "content/exposicoes",
          create: true,
          slug: "{{slug}}",
          fields: [
            { label: "Título", name: "title", widget: "string" },
            { label: "Data", name: "date", widget: "datetime" },
            { label: "Local", name: "location", widget: "string" },
            { label: "Descrição", name: "body", widget: "markdown" }
          ]
        }
      ]
    };

    // 2. Inicializamos apenas quando o script externo carregar
    // e o DOM estiver pronto
    window.onload = () => {
      if (window.CMS) {
        window.CMS.init({ config: window.CMS_CONFIG });
      } else {
        console.error("Decap CMS não pôde ser carregado.");
      }
    };
  </script>
</body>
</html>